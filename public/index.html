<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulaci√≥n TCP - UAB</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <header>
    <a href="#main" class="skip-link">Saltar al contenido principal</a>
    <nav class="navbar" aria-label="Navegaci√≥n principal" role="navigation">
      <div class="navbar-container">
        <div class="brand">
          <a href="#main" class="brand-link">
            <span class="brand-text">Universitat Aut√≤noma de Barcelona</span>
          </a>
        </div>
        <button class="menu-toggle" aria-label="Mostrar u ocultar men√∫">‚ò∞</button>
        <ul class="nav-links" role="menubar" aria-label="Men√∫ principal">
          <li><a href="#main" role="menuitem" data-hash="main">Inicio</a></li>
          <li><a href="#definition" role="menuitem" data-hash="definition">Definici√≥n TCP</a></li>
          <li><a href="#connection-setup" role="menuitem" data-hash="connection-setup">Establecimiento</a></li>
          <li><a href="#data-transmission" role="menuitem" data-hash="data-transmission">Transmisi√≥n</a></li>
          <li><a href="#connection-termination" role="menuitem" data-hash="connection-termination">Finalizaci√≥n</a></li>
          <li><a href="#simulation-selection" role="menuitem" data-hash="simulation-selection">Simulation</a></li>
        </ul>
        <div class="user-menu" aria-label="Men√∫ de usuario">
          <span id="user-icon" aria-label="Icono de usuario" class="user-icon">üë§</span>
          <div class="dropdown-content" id="user-dropdown">
            <a href="#profile">Perfil</a>
            <a href="#login">Iniciar Sesi√≥n</a>
            <a href="#register">Registrarse</a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <div id="loader" aria-hidden="true"><div class="spinner"></div></div>
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <main>
    <!-- MAIN -->
    <section id="main" class="view active">
      <div class="hero">
        <div class="hero-text">
          <h1>Simulaci√≥n de M√°quina de Estados TCP</h1>
          <p>Explora y comprende el protocolo TCP en acci√≥n</p>
        </div>
      </div>
      <div class="container">
        <div id="welcome-message"></div>
        <p>Esta herramienta te permitir√°:</p>
        <ul>
          <li>Entender el three-way handshake (SYN, SYN-ACK, ACK)</li>
          <li>Observar transmisi√≥n ordenada, control de flujo y congesti√≥n</li>
          <li>Ver la finalizaci√≥n de la conexi√≥n (FIN/ACK, TIME-WAIT)</li>
          <li>Guardar simulaciones para an√°lisis acad√©mico</li>
        </ul>
        <p><strong>¬øPor qu√© TCP?</strong> Comprender TCP es entender el pilar fundamental de la comunicaci√≥n confiable en Internet, esencial en entornos acad√©micos e investigativos.</p>
        <button onclick="window.location.hash='definition'" class="secondary-btn">Saber m√°s sobre TCP</button>

        <h3>¬øC√≥mo empezar?</h3>
        <ol class="getting-started-steps">
          <li>üë§ Inicia sesi√≥n o reg√≠strate.</li>
          <li>üìÅ Selecciona o crea una simulaci√≥n.</li>
          <li>‚öôÔ∏è Configura par√°metros y presiona "Iniciar Simulaci√≥n".</li>
          <li>üëÅÔ∏è Observa mensajes y estados para entender el comportamiento de TCP.</li>
        </ol>

        <h4>Requisitos previos</h4>
        <ul>
          <li>Nociones b√°sicas de redes e IP</li>
          <li>Familiaridad con el intercambio SYN, ACK de TCP</li>
        </ul>

        <div id="main-action-buttons"></div>
      </div>
    </section>

    <!-- DEFINICI√ìN TCP -->
    <section id="definition" class="view">
      <div class="container">
        <h2>Definici√≥n de TCP</h2>
        <h3>¬øQu√© es TCP?</h3>
        <p>El <strong>Transmission Control Protocol (TCP)</strong> es uno de los protocolos centrales que sustentan el funcionamiento de Internet. Se trata de un protocolo de transporte confiable y orientado a conexi√≥n que se utiliza sobre la capa de red IP. Si piensas en Internet como un sistema postal, IP ser√≠a el servicio b√°sico de entrega de paquetes (sin muchas garant√≠as), mientras que TCP actuar√≠a como un mensajero privado que garantiza que tus paquetes se entreguen en orden y completos.</p>
        <p>A diferencia de protocolos sin conexi√≥n como UDP, TCP establece una relaci√≥n m√°s formal entre emisor y receptor antes de transferir datos, asegurando una comunicaci√≥n robusta. Es como si, antes de empezar a hablar, ambos interlocutores se aseguraran de que se escuchan claramente y acordaran un ritmo c√≥modo de conversaci√≥n.</p>
    
        <h3>¬øPor qu√© es tan importante TCP?</h3>
        <ul>
          <li><strong>Fiabilidad:</strong> TCP garantiza que los datos no se pierdan. Si un paquete no llega, se retransmite. Esto es esencial para aplicaciones como la web (HTTP), correo electr√≥nico (SMTP) o transferencia de archivos (FTP).</li>
          <li><strong>Orden:</strong> Los datos llegan en el mismo orden en que se enviaron. TCP reordena paquetes si es necesario, dando al receptor un flujo coherente de informaci√≥n.</li>
          <li><strong>Control de Flujo:</strong> Ajusta la velocidad a la que se env√≠an datos en funci√≥n de lo que el receptor pueda procesar, evitando "inundaciones" que puedan saturar la recepci√≥n.</li>
          <li><strong>Control de Congesti√≥n:</strong> TCP detecta cu√°ndo la red est√° muy ocupada y reduce su tasa de env√≠o para no agravar la situaci√≥n. Esto beneficia a todos los usuarios que comparten la red.</li>
          <li><strong>Orientado a Conexi√≥n:</strong> Antes de enviar datos, se establece una conexi√≥n l√≥gica entre emisor y receptor mediante un intercambio inicial de paquetes de sincronizaci√≥n (SYN/ACK). Esto asegura que ambas partes est√©n listas para comunicar datos.</li>
        </ul>
    
        <h3>Rol de TCP en la Pila de Protocolos</h3>
        <pre class="code-block">
    Aplicaciones (HTTP, SMTP, FTP...)
             |
            TCP  <-- A√±ade fiabilidad, control de flujo y congesti√≥n
             |
            IP   <-- Transporte "best-effort", no confiable
             |
    Capa Enlace / F√≠sica (Ethernet, Wi-Fi...)
        </pre>
        <p>TCP funciona encima de IP, que es "best-effort" (no garantiza entrega). TCP a√±ade fiabilidad y control, construyendo un transporte robusto para que las aplicaciones no tengan que preocuparse por paquetes perdidos o desordenados.</p>
    
        <h3>Un Poco de Historia</h3>
        <p>TCP fue definido originalmente en el RFC 793 (publicado en 1981). Desde entonces, ha evolucionado con m√∫ltiples mejoras y extensiones. Este protocolo ha permitido la escalabilidad de Internet, haciendo posibles servicios que requieren integridad de datos, como el streaming de video, banca en l√≠nea o videoconferencias.</p>
    
        <h3>Referencias</h3>
        <ul>
          <li><a href="https://www.rfc-editor.org/rfc/rfc793" target="_blank">RFC 793 - TCP</a> (documento base)</li>
          <li>Kurose & Ross, "Computer Networking: A Top-Down Approach"</li>
          <li>Tanenbaum & Wetherall, "Computer Networks"</li>
          <li>Art√≠culos y cursos en l√≠nea sobre fundamentos de protocolos de red.</li>
        </ul>
      </div>
    </section>
    
    <!-- ESTABLECIMIENTO DE CONEXI√ìN -->
    <section id="connection-setup" class="view">
      <div class="container">
        <h2>Establecimiento de Conexi√≥n</h2>
        <h3>Three-Way Handshake</h3>
        <p>Imag√≠nate que quieres tener una conversaci√≥n telef√≥nica con alguien. Antes de empezar a hablar de un tema importante, ambos se saludan y confirman que pueden escucharse bien, ¬øverdad? El <strong>three-way handshake</strong> (intercambio de tres mensajes) en TCP funciona de manera similar. Es un protocolo que asegura que ambas partes (cliente y servidor) est√©n preparadas para comunicarse y sepan c√≥mo sincronizar sus contadores de secuencia.</p>
        <ol class="getting-started-steps">
          <li><strong>SYN:</strong> El cliente env√≠a un mensaje al servidor indicando "Quiero iniciar una conexi√≥n" y propone un n√∫mero de secuencia inicial.</li>
          <li><strong>SYN-ACK:</strong> El servidor responde con un mensaje que a la vez acepta la conexi√≥n (SYN) y confirma la recepci√≥n del mensaje del cliente (ACK).</li>
          <li><strong>ACK:</strong> Finalmente, el cliente responde con un ACK para confirmar la respuesta del servidor. Ahora ambos han acordado c√≥mo iniciar√°n la transmisi√≥n de datos.</li>
        </ol>
        <pre class="code-block">
    Cliente --SYN--> Servidor
    Servidor --SYN-ACK--> Cliente
    Cliente --ACK--> Servidor
    
    Conexi√≥n Establecida
        </pre>
        <p>Este proceso garantiza que ambos extremos conozcan los n√∫meros de secuencia iniciales del otro, evitando confusiones y asegurando que los datos no se mezclen con comunicaciones previas.</p>
    
        <h3>Analog√≠a Sencilla</h3>
        <p>Piensa en dos personas salud√°ndose con un apret√≥n de manos:  
        - Persona A extiende la mano (SYN),  
        - Persona B extiende su mano y asiente con la cabeza (SYN-ACK),  
        - Persona A asiente tambi√©n con la cabeza (ACK).  
        Ahora ambos est√°n listos para conversar. Esta preparaci√≥n previa evita que uno empiece a hablar cuando el otro no est√° listo, o que se malinterpreten mensajes.</p>
      </div>
    </section>
    

    <!-- TRANSMISI√ìN DE DATOS -->
    <section id="data-transmission" class="view">
      <div class="container">
        <h2>Transmisi√≥n de Datos</h2>
        <h3>Control de Flujo</h3>
        <p>El <strong>control de flujo</strong> es como acordar una velocidad c√≥moda para una conversaci√≥n. Si hablas demasiado r√°pido, tu interlocutor no podr√° seguirte. De igual forma, TCP usa la "ventana de recepci√≥n" declarada por el receptor para que el emisor no env√≠e m√°s datos de los que el otro lado puede procesar. As√≠, se garantiza que el receptor no se desborde y pierda informaci√≥n.</p>
    
        <h3>Control de Congesti√≥n</h3>
        <p>La red es un recurso compartido. Si muchos env√≠an datos a la vez sin regulaci√≥n, se produce congesti√≥n (como un atasco en una autopista). TCP ajusta din√°micamente su tasa de env√≠o seg√∫n las condiciones de la red. Empezar√° enviando pocos datos y, si no hay p√©rdidas, ir√° aumentando gradualmente la ventana de congesti√≥n. Si detecta p√©rdidas (se√±al de congesti√≥n), reduce el ritmo. Esto permite compartir el ancho de banda de forma justa.</p>
    
        <h3>Retransmisiones y Temporizadores</h3>
        <p>Si un paquete se pierde, TCP lo retransmite. Para determinar cu√°ndo retransmitir, TCP calcula un <em>timeout</em> basado en el tiempo de ida y vuelta (RTT). Ajustar correctamente este temporizador evita retransmisiones prematuras (que aumentar√≠an el tr√°fico innecesariamente) y muy tard√≠as (que afectar√≠an el rendimiento).</p>
    
        <h3>Ventana Deslizante</h3>
        <p>TCP utiliza un mecanismo de ventana deslizante para administrar la transmisi√≥n:  
        <pre class="code-block">
    [Enviado y ACK][ En Vuelo (no ACK) ][A√∫n por Enviar]
        </pre>
        Cuando el receptor env√≠a ACKs, la ventana se "mueve", permitiendo al emisor enviar m√°s datos. As√≠ se mantiene un equilibrio din√°mico entre la velocidad de env√≠o y la capacidad real de la red y el receptor.</p>
    
        <h3>Analog√≠as para Entenderlo Mejor</h3>
        <ul>
          <li><strong>Control de Flujo:</strong> Imagina que est√°s sirviendo agua a un vaso (receptor). No viertes el agua muy r√°pido o derramar√°s. Ajustas el chorro seg√∫n la capacidad del vaso.</li>
          <li><strong>Control de Congesti√≥n:</strong> Si en una carretera (la red) hay mucho tr√°fico, disminuyes la velocidad. Si la v√≠a est√° despejada, aceleras. TCP hace lo mismo con los datos.</li>
        </ul>
      </div>
    </section>
    

    <!-- FINALIZACI√ìN -->
    <section id="connection-termination" class="view">
      <div class="container">
        <h2>Finalizaci√≥n de Conexi√≥n</h2>
        <h3>Proceso de Cierre</h3>
        <p>Al igual que iniciaste la conversaci√≥n con un saludo, es importante cerrarla ordenadamente. La finalizaci√≥n de TCP se realiza mediante el intercambio de mensajes FIN y ACK. Cada extremo indica que ya no tiene m√°s datos que enviar, pero escucha un momento m√°s por si el otro todav√≠a tiene datos en vuelo.</p>
        <ol class="getting-started-steps">
          <li>‚û°Ô∏è FIN: Uno de los extremos dice "He terminado de hablar".</li>
          <li>‚û°Ô∏è ACK: El otro extremo confirma "He entendido que terminaste".</li>
          <li>‚û°Ô∏è FIN: Ahora el otro lado indica tambi√©n que no tiene m√°s datos.</li>
          <li>‚û°Ô∏è ACK: Finalmente, se confirma el cierre mutuo.</li>
        </ol>
        <pre class="code-block">
    FIN-WAIT-1 -> FIN-WAIT-2 -> TIME-WAIT -> CLOSED
        </pre>
        <p>El estado <strong>TIME-WAIT</strong> asegura que cualquier mensaje retrasado en la red no se confunda con una nueva conexi√≥n. Es como esperar unos segundos despu√©s de colgar el tel√©fono para asegurarte de que la otra persona tambi√©n colg√≥ y no se oyen m√°s voces o ecos.</p>
      </div>
    </section>    

    <!-- PERFIL DE USUARIO -->
    <section id="profile" class="view">
      <div class="container">
        <h2>Perfil de Usuario</h2>
        <p>Define tu rol acad√©mico. Esto a√±ade contexto a las simulaciones, ayud√°ndote a centrar el an√°lisis en aspectos relevantes a tu funci√≥n (estudiante, profesor, investigador).</p>
        <div class="center-content margin-bottom-20">
          <div class="avatar-circle">üë§</div>
        </div>
        <div id="profile-container"></div>
      </div>
    </section>

    <!-- SELECCI√ìN DE SIMULACI√ìN -->
    <section id="simulation-selection" class="view">
      <div class="container">
        <h2>Seleccionar Simulaci√≥n</h2>
        <p>Crea nuevas simulaciones o utiliza trazas reales para un an√°lisis m√°s profundo. Esto te permite comparar escenarios te√≥ricos con condiciones reales capturadas en la red, enriqueciendo el aprendizaje.</p>

        <div id="simulation-list-container" class="simulation-list-container">
          <ul id="simulation-list" class="simulation-list"></ul>
        </div>

        <button onclick="createNewSimulation()" class="secondary-btn">Crear Nueva Simulaci√≥n</button>

        <h3>Cargar Simulaci√≥n desde Archivo Wireshark</h3>
        <p>Arrastra un .pcap o .pcapng, o selecciona el archivo:</p>

        <div id="wireshark-upload" class="upload-zone" ondragover="event.preventDefault();" ondrop="handleFileDrop(event);">
          <p><strong>Arrastra tu archivo aqu√≠</strong> o haz clic para seleccionar uno.</p>
          <input type="file" id="wireshark-file-input" accept=".pcap,.pcapng" onchange="handleFileInputChange(event);">
          <button type="button" onclick="document.getElementById('wireshark-file-input').click()" class="secondary-btn">Seleccionar Archivo</button>
        </div>
      </div>
    </section>

    <!-- SIMULACI√ìN TCP -->
    <section id="tcp-simulation" class="view">
      <div class="container">
        <h2>Simulaci√≥n TCP</h2>
    
        <!-- PRE-SIMULATION VIEW -->
        <div id="pre-simulation">
          <p>Ajusta par√°metros y luego inicia la simulaci√≥n.</p>
          <h3>Par√°metros de Simulaci√≥n</h3>
          <ul class="param-list">
            <li><strong>Tama√±o Ventana (bytes):</strong> <input type="number" id="window-size-input" value="1024"></li>
            <li><strong>Datos Nodo A (bytes):</strong> <input type="number" id="data-size-input-A" value="1000"></li>
            <li><strong>Datos Nodo B (bytes):</strong> <input type="number" id="data-size-input-B" value="0"></li>
            <li><strong>MSS:</strong> <input type="number" id="mss-input" value="1460"></li>
            <li><strong>Ratio de P√©rdida:</strong> 
              <input type="range" id="loss-ratio-input" min="0" max="1" step="0.1" value="0"> 
              <span id="loss-ratio-value">0</span>
            </li>
          </ul>
    
          <h3>Controles</h3>
          <button id="start-simulation-btn" onclick="startSimulation()">Iniciar Simulaci√≥n</button>
          <button onclick="goBackToSelection()" class="secondary-btn">Volver a Selecci√≥n de Simulaciones</button>
        </div>
    
        <!-- POST-SIMULATION VIEW -->
        <div id="post-simulation" style="display:none;">
          <p>La simulaci√≥n est√° en marcha. Observa el intercambio de mensajes y la evoluci√≥n de la conexi√≥n.</p>
    
          <h3>Historial de Mensajes</h3>
          <div class="history-container">
            <div>
              <h4>Nodo A</h4>
              <ul id="state-history-A" class="message-list"></ul>
            </div>
            <div>
              <h4>Nodo B</h4>
              <ul id="state-history-B" class="message-list"></ul>
            </div>
          </div>
    
          <h3>Visualizaci√≥n</h3>
          <p>El diagrama temporal muestra c√≥mo evoluciona la conexi√≥n. Ajusta el zoom temporal para una visi√≥n m√°s detallada.</p>
          <p><strong>Leyenda:</strong></p>
          <ul class="legend-list">
            <li><span class="legend-syn"></span> SYN / SYN-ACK</li>
            <li><span class="legend-ack"></span> ACK puro</li>
            <li><span class="legend-fin"></span> FIN</li>
            <li><span class="legend-data"></span> Datos</li>
          </ul>
    
          <fieldset style="margin-bottom:20px;">
            <legend>Filtros de Mensajes</legend>
            <label><input type="checkbox" id="filter-syn" checked> Mostrar SYN</label>
            <label><input type="checkbox" id="filter-ack" checked> Mostrar ACK</label>
            <label><input type="checkbox" id="filter-fin" checked> Mostrar FIN</label>
            <label><input type="checkbox" id="filter-data" checked> Mostrar Datos</label>
          </fieldset>
    
          <h4>Zoom Temporal</h4>
          <p>Ajusta la escala para ver eventos m√°s juntos o separados:</p>
          <input type="range" id="time-zoom-input" min="50" max="2000" value="200">
          <span id="time-zoom-value">200</span>
    
          <div id="visual-container" class="visual-container">
            <svg id="simulation-visual"></svg>
          </div>
          <p>El gr√°fico de la evoluci√≥n de la ventana muestra c√≥mo TCP ajusta su env√≠o seg√∫n condiciones reales:</p>
          <div id="window-chart-container" class="window-chart-container">
            <svg id="window-chart" width="800" height="200"></svg>
          </div>
    
          <button onclick="goBackToSelection()" class="secondary-btn">Volver a Selecci√≥n de Simulaciones</button>
        </div>
      </div>
    </section>
    

    <!-- LOGIN -->
    <section id="login" class="view">
      <div class="container">
        <h2>Iniciar Sesi√≥n</h2>
        <p>Inicia sesi√≥n para acceder a tus simulaciones. Podr√°s retomar experimentos, guardarlos y compararlos en el tiempo, potenciando tu aprendizaje.</p>
        
        <p><strong>Protege tu cuenta:</strong> Usa una contrase√±a segura. Datos con fines acad√©micos.</p>

        <label for="username">Nombre de usuario:</label>
        <input type="text" id="username" placeholder="Ej: alumno_uab">

        <label for="password">Contrase√±a:</label>
        <input type="password" id="password" placeholder="M√≠nimo 6 caracteres">

        <div>
          <label><input type="checkbox" id="remember-me"> Recordar sesi√≥n</label>
        </div>

        <div class="auth-buttons">
          <button onclick="login()">Iniciar Sesi√≥n</button>
          <a href="#register">¬øNo tienes cuenta? Reg√≠strate</a>
        </div>

        <hr>

        <p>O inicia sesi√≥n con tu cuenta de Google:</p>
        <button onclick="loginWithGoogle()" class="secondary-btn">G Iniciar Sesi√≥n con Google</button>
      </div>
    </section>

    <!-- REGISTRARSE -->
    <section id="register" class="view">
      <div class="container">
        <h2>Registrarse</h2>
        <p>Crea una cuenta para mantener tus simulaciones organizadas, permitiendo un an√°lisis m√°s exhaustivo a lo largo del tiempo. Ideal para estudiantes y acad√©micos interesados en experimentos de protocolo.</p>

        <label for="username-reg">Nombre de usuario:</label>
        <input type="text" id="username-reg" placeholder="Ej: alumno_uab">

        <label for="password-reg">Contrase√±a:</label>
        <input type="password" id="password-reg" placeholder="M√≠nimo 6 caracteres">

        <div class="auth-buttons">
          <button onclick="registerUser()">Registrarse</button>
          <a href="#login">¬øYa tienes cuenta? Inicia Sesi√≥n</a>
        </div>

        <hr>

        <p>O reg√≠strate con tu cuenta de Google:</p>
        <button onclick="registerWithGoogle()" class="secondary-btn">G Registrarse con Google</button>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container">
      <p>&copy; 2024 Universitat Aut√≤noma de Barcelona</p>
      <p>Herramienta para fines acad√©micos. <a href="https://www.uab.cat/" target="_blank">Visita la UAB</a></p>
      <p>Documentaci√≥n TCP: <a href="https://www.rfc-editor.org/rfc/rfc793" target="_blank">RFC 793</a></p>
    </div>
  </footer>

  <div class="tooltip" id="tooltip"></div>
  <script src="app.js"></script>
</body>
</html>
